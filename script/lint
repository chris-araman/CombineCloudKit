#!/bin/bash -e

if [[ ! -x "$(command -v brew)" ]]; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

brew bundle install --no-lock --quiet >/dev/null

echo "âš™ï¸  Linting CombineCloudKit..."

echo "  ðŸ§¹ git"
git diff --check

echo "  ðŸ§¹ markdownlint"
markdownlint --config .markdownlint.json --fix .github .

echo "  ðŸ§¹ shfmt"
shfmt -d -i 2 -l -w script/

echo "  ðŸ§¹ swift-format"
swift build --product swift-format >/dev/null
SOURCES=(
  Package.swift
  Sources
  Tests
)
swift run --skip-build swift-format format --in-place --recursive ${SOURCES[@]}
swift run --skip-build swift-format lint --recursive ${SOURCES[@]}

echo "  ðŸ§¹ periphery"
periphery scan --retain-public --strict --quiet

echo "âœ… CombineCloudKit is free of lint!"
