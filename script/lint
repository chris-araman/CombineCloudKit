#!/bin/bash -e

if [[ ! -x "$(command -v brew)" ]]; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

brew bundle install --no-lock --quiet >/dev/null

echo "โ๏ธ  Linting CombineCloudKit..."

echo "  ๐งน git"
git diff --check

echo "  ๐งน markdownlint"
markdownlint --config .markdownlint.json --fix .github .

echo "  ๐งน periphery"
periphery scan --quiet

echo "  ๐งน pod"
pod lib lint --silent CombineCloudKit.podspec

echo "  ๐งน prettier"
prettier --loglevel warn --write .

echo "  ๐งน shellcheck"
SCRIPTS=(
  script/build_docs
  script/lint
)
shellcheck --shell=bash "${SCRIPTS[@]}"

echo "  ๐งน shfmt"
shfmt -d -i 2 -l -w "${SCRIPTS[@]}"

echo "  ๐งน swift-format"
SOURCES=(
  Package*.swift
  Sources
  Tests
)
swift format format --in-place --recursive "${SOURCES[@]}"
swift format lint --recursive "${SOURCES[@]}"

echo "โ CombineCloudKit is free of lint!"
