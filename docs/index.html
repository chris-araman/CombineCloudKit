<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CombineCloudKit  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="CombineCloudKit  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          CombineCloudKit 1.0.2 Docs
        </a>
         (100% documented)
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/chris-araman/CombineCloudKit">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">CombineCloudKit Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      CombineCloudKit  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Progress.html">Progress</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/c:objc(cs)CKContainer">CKContainer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/c:objc(cs)CKDatabase">CKDatabase</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CCKContainer.html">CCKContainer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CCKDatabase.html">CCKDatabase</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='Ô∏è-combinecloudkit' class='heading'>‚õÖÔ∏è CombineCloudKit</h1>

<p>Swift Combine extensions for reactive CloudKit record processing. Designed for simplicity.</p>

<p><a href="https://swiftpackageindex.com/chris-araman/CombineCloudKit"><img src="https://img.shields.io/endpoint?label=swift&logo=swift&style=flat-square&url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fchris-araman%2FCombineCloudKit%2Fbadge%3Ftype%3Dswift-versions" alt="Swift"></a>
<a href="https://swiftpackageindex.com/chris-araman/CombineCloudKit"><img src="https://img.shields.io/endpoint?label=platforms&logo=apple&style=flat-square&url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fchris-araman%2FCombineCloudKit%2Fbadge%3Ftype%3Dplatforms" alt="Platforms"></a>
<a href="https://github.com/chris-araman/CombineCloudKit/blob/main/LICENSE.md"><img src="https://img.shields.io/github/license/chris-araman/CombineCloudKit?style=flat-square&color=informational" alt="License"></a>
<a href="https://github.com/chris-araman/CombineCloudKit/releases"><img src="https://img.shields.io/github/v/tag/chris-araman/CombineCloudKit?style=flat-square&color=informational&label=release&sort=semver" alt="Release"></a></p>

<p><a href="https://github.com/chris-araman/CombineCloudKit/actions/workflows/ci.yml?query=branch%3Amain"><img src="https://img.shields.io/github/workflow/status/chris-araman/CombineCloudKit/Continuous%20Integration/main?style=flat-square&logo=github&label=lint%20%7C%20build%20%7C%20test" alt="Lint | Build | Test"></a>
<a href="https://app.codecov.io/gh/chris-araman/CombineCloudKit/"><img src="https://img.shields.io/codecov/c/github/chris-araman/CombineCloudKit/main?style=flat-square&color=informational" alt="Coverage"></a></p>

<p>CombineCloudKit exposes <a href="https://developer.apple.com/documentation/cloudkit">CloudKit</a> operations as
<a href="https://developer.apple.com/documentation/combine">Combine</a> publishers. Publishers can be used to process values over
time, using Combine&rsquo;s declarative API.</p>
<h2 id='adding-combinecloudkit-to-your-project' class='heading'>üì¶ Adding CombineCloudKit to Your Project</h2>

<p>CombineCloudKit supports <a href="https://developer.apple.com/documentation/swift_packages">Swift Package Manager</a>,
<a href="https://cocoapods.org/about">CocoaPods</a>, and <a href="https://github.com/Carthage/Carthage">Carthage</a>. You can use whichever
you prefer, but Swift Package Manager is most likely to be supported in the future.</p>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>

<p>Add a dependency on CombineCloudKit to your
<a href="https://docs.swift.org/package-manager/PackageDescription/PackageDescription.html"><code>Package.swift</code></a> using
<a href="https://developer.apple.com/documentation/xcode/adding_package_dependencies_to_your_app">Xcode</a> or the
<a href="https://swift.org/package-manager/">Swift Package Manager</a>. Optionally, specify a
<a href="https://docs.swift.org/package-manager/PackageDescription/PackageDescription.html#package-dependency-requirement">version requirement</a>.</p>
<pre class="highlight swift"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
  <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/chris-araman/CombineCloudKit.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">)</span>
<span class="p">]</span>
</code></pre>

<p>Then resolve the dependency:</p>
<pre class="highlight shell"><code>swift package resolve
</code></pre>

<p>To update to the latest CombineCloudKit version compatible with your version requirement:</p>
<pre class="highlight shell"><code>swift package update CombineCloudKit
</code></pre>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>

<p>Add a <a href="https://guides.cocoapods.org/using/using-cocoapods.html#adding-pods-to-an-xcode-project">dependency</a> on
CombineCloudKit to your <a href="https://guides.cocoapods.org/using/the-podfile.html"><code>Podfile</code></a>. Optionally, specify a
<a href="https://guides.cocoapods.org/using/the-podfile.html#specifying-pod-versions">version requirement</a>.</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'CombineCloudKit'</span><span class="p">,</span> <span class="s1">'~&gt;1.0'</span>
</code></pre>

<p>Then <a href="https://guides.cocoapods.org/using/pod-install-vs-update.html">install</a> the dependency:</p>
<pre class="highlight shell"><code>pod <span class="nb">install</span>
</code></pre>

<p>To <a href="https://guides.cocoapods.org/using/pod-install-vs-update.html">update</a> to the latest CombineCloudKit version
compatible with your version requirement:</p>
<pre class="highlight shell"><code>pod update CombineCloudKit
</code></pre>
<h3 id='carthage' class='heading'>Carthage</h3>

<p>Add a dependency on CombineCloudKit to your
<a href="https://github.com/Carthage/Carthage/blob/master/Documentation/Artifacts.md#cartfile"><code>Cartfile</code></a>.
Optionally, specify a
<a href="https://github.com/Carthage/Carthage/blob/master/Documentation/Artifacts.md#version-requirement">version requirement</a>.</p>
<pre class="highlight plaintext"><code>github "chris-araman/CombineCloudKit" ~&gt; 1.0
</code></pre>

<p>Because Carthage assumes dependencies are provided as shared frameworks, but Swift Package Manager builds only libraries
or executables, we have to generate an <code>.xcodeproj</code> for Carthage to use.</p>

<blockquote>
<p>‚ö†Ô∏è The <code>generate-xcodeproj</code> command has been deprecated. This solution may stop working in a future release of the Swift
Package Manager.</p>
</blockquote>
<pre class="highlight shell"><code>carthage bootstrap <span class="nt">--no-build</span>
<span class="nb">pushd </span>Carthage/Checkouts/CombineCloudKit <span class="o">&amp;&amp;</span> swift package generate-xcodeproj <span class="o">&amp;&amp;</span> <span class="nb">popd
</span>carthage bootstrap <span class="nt">--use-xcframeworks</span>
</code></pre>

<p>To update to the latest CombineCloudKit version compatible with your version requirement:</p>
<pre class="highlight shell"><code>carthage update CombineCloudKit <span class="nt">--use-xcframeworks</span>
</code></pre>
<h2 id='using-combinecloudkit-in-your-project' class='heading'>üå§ Using CombineCloudKit in Your Project</h2>

<p>Combine allows you to chain value processing <a href="https://developer.apple.com/documentation/combine/publisher">Publishers</a>
for one or more <a href="https://developer.apple.com/documentation/combine/subscriber">Subscribers</a>. Here, we perform a query on
our <a href="https://developer.apple.com/documentation/cloudkit/ckdatabase"><code>CKDatabase</code></a>, then process the results
asynchronously. As each <a href="https://developer.apple.com/documentation/cloudkit/ckrecord"><code>CKRecord</code></a> is read from the
database, it is passed to the <a href="https://developer.apple.com/documentation/combine/publishers/merge/map(_:)-6v8fv"><code>map</code></a>
publisher which publishes the value of the record&rsquo;s name field. Any errors in the chain so far can be handled in the
catch publisher, which passes <a href="https://developer.apple.com/documentation/cloudkit/ckrecordvalue"><code>CKRecordValue</code></a> values
along to our <a href="https://developer.apple.com/documentation/combine/fail/sink(receivevalue:)"><code>sink</code></a> subscriber where the
final values are processed.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">CloudKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>
<span class="kd">import</span> <span class="kt">CombineCloudKit</span>

<span class="kd">func</span> <span class="nf">queryDueItems</span><span class="p">(</span><span class="nv">database</span><span class="p">:</span> <span class="kt">CKDatabase</span><span class="p">,</span> <span class="nv">due</span><span class="p">:</span> <span class="kt">Date</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">database</span>
    <span class="o">.</span><span class="nf">performQuery</span><span class="p">(</span><span class="nv">ofType</span><span class="p">:</span> <span class="s">"ToDoItem"</span><span class="p">,</span> <span class="nv">where</span><span class="p">:</span> <span class="kt">NSPredicate</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"due &gt;= %@"</span><span class="p">,</span> <span class="n">due</span><span class="p">))</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">record</span><span class="p">:</span> <span class="kt">CKRecord</span> <span class="o">-&gt;</span> <span class="kt">CKRecordValue</span> <span class="k">in</span>
      <span class="c1">// Map each ToDoItem to its Name</span>
      <span class="nf">print</span><span class="p">(</span><span class="s">"Received record: </span><span class="se">\(</span><span class="n">record</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">record</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span>
    <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span> <span class="k">in</span>
      <span class="c1">// Handle any upstream error</span>
      <span class="nf">print</span><span class="p">(</span><span class="s">"Received error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">CKRecordValue</span> <span class="k">in</span>
      <span class="c1">// Process the Name of each ToDoItems</span>
      <span class="nf">print</span><span class="p">(</span><span class="s">"Received result: </span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<h3 id='queueing-and-cancellation' class='heading'>Queueing and Cancellation</h3>

<p>Just creating a <code>Publisher</code> does not queue a CloudKit operation. An operation is queued only once a <code>Subscriber</code>
subscribes to the <code>Publisher</code> and indicates
<a href="https://developer.apple.com/documentation/combine/subscribers/demand"><code>Demand</code></a>.</p>

<p>Note that the <a href="https://developer.apple.com/documentation/combine/cancellable"><code>Cancellable</code></a> subscriber from
<a href="https://developer.apple.com/documentation/combine/fail/sink(receivevalue:)"><code>sink</code></a> will cancel the upstream publishers
when it is deinitialized. Take care to ensure that your subscribers live long enough to process values. If a
CombineCloudKit publisher is cancelled before it is finished emitting values, the underlying
<a href="https://developer.apple.com/documentation/cloudkit/ckoperation"><code>CKOperation</code></a> will be cancelled. This may be desirable
when performing a query and processing only the first few results. However, failing to wait for completion of a <code>save</code>,
<code>delete</code>, or <code>modify</code> operation may result in undesirable cancellation.</p>

<p>Note that because the <code>atBackgroundPriority</code> publishers are built on <code>CKDatabase</code> methods that do not provide means of
cancellation, they will not respond to requests for cancellation. If you need the publishers to respond to requests for
cooperative cancellation, please use the publishers that do not have <code>atBackgroundPriority</code> in their names. You can
still specify
<a href="https://developer.apple.com/documentation/foundation/qualityofservice/background"><code>QualityOfService.background</code></a>
by passing in a
<a href="https://developer.apple.com/documentation/cloudkit/ckoperation/configuration"><code>CKOperation.Configuration</code></a>.</p>
<h3 id='sharing-publishers-among-multiple-subscribers' class='heading'>Sharing Publishers among Multiple Subscribers</h3>

<p>If two or more <code>Subscriber</code>s subscribe to the same CombineCloudKit <code>Publisher</code>, the operation will be queued twice.
This may be surprising if you&rsquo;re new to Combine! Queueing the same database operation twice could be inefficient or
potentially harmful. If you need to subscribe to a <code>Publisher</code> twice, use the
<a href="https://developer.apple.com/documentation/combine/publisher/share()"><code>share</code></a> and
<a href="https://developer.apple.com/documentation/combine/publisher/makeconnectable()"><code>makeConnectable</code></a>
operators. This will ensure the operation is queued only once.</p>

<p>I considered making the <code>Publisher</code>s all conform to
<a href="https://developer.apple.com/documentation/combine/connectablepublisher"><code>ConnectablePublisher</code></a>
by default, but that would require all callers to call
<a href="https://developer.apple.com/documentation/combine/connectablepublisher/connect()"><code>connect</code></a>
explicitly or to use the
<a href="https://developer.apple.com/documentation/combine/connectablepublisher/autoconnect()"><code>autoconnect</code></a>
operator, even if they did not intend to share the <code>Publisher</code>.</p>

<p>For more on this topic, please review:</p>

<ul>
<li><a href="https://developer.apple.com/documentation/combine/controlling-publishing-with-connectable-publishers">Controlling Publishing with Connectable Publishers</a></li>
</ul>
<h2 id='documentation' class='heading'>üìò Documentation</h2>

<p>üíØ% <a href="https://combinecloudkit.hiddenplace.dev">documented</a> using <a href="https://github.com/realm/jazzy">Jazzy</a>.
Hosted by <a href="https://pages.github.com">GitHub Pages</a>.</p>
<h2 id='Ô∏è-contributing' class='heading'>‚ù§Ô∏è Contributing</h2>

<p><a href="https://github.com/chris-araman/CombineCloudKit/blob/main/CONTRIBUTING.md">Contributions</a> are welcome!</p>
<h2 id='further-reading' class='heading'>üìö Further Reading</h2>

<p>To learn more about Combine and CloudKit, watch these videos from WWDC:</p>

<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/722">Introducing Combine</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/721">Combine in Practice</a></li>
</ul>

<p>&hellip;or review Apple&rsquo;s documentation:</p>

<ul>
<li><a href="https://developer.apple.com/icloud/cloudkit/">CloudKit Overview</a></li>
<li><a href="https://developer.apple.com/documentation/cloudkit">CloudKit Documentation</a></li>
<li><a href="https://developer.apple.com/documentation/combine">Combine Documentation</a></li>
</ul>

<p>If you&rsquo;re looking for Swift concurrency extensions for CloudKit using <code>async</code>, <code>await</code>,
and <code>AsyncSequence</code>, take a look at <a href="https://github.com/chris-araman/AsyncCloudKit">AsyncCloudKit</a>!</p>
<h2 id='license' class='heading'>üìú License</h2>

<p>CombineCloudKit was created by <a href="https://github.com/chris-araman">Chris Araman</a>. It is published under the
<a href="https://github.com/chris-araman/CombineCloudKit/blob/main/LICENSE.md">MIT license</a>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="https://github.com/chris-araman" target="_blank" rel="external noopener">Chris Araman</a>. All rights reserved. (Last updated: 2021-12-26)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ‚ô™‚ô´ v0.14.1</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
